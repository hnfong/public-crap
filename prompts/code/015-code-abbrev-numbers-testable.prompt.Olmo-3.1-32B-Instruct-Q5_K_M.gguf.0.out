def abbrev_num(x):
    if abs(x) < 1000:
        return str(int(x) if x == int(x) else round(x, 1))[:4]
    units = ['', 'K', 'M', 'B', 'T']
    val = float(x)
    i = 0
    while abs(val) >= 1000 and i < len(units) - 1:
        val /= 1000.0
        i += 1
    # Format with up to 2 significant digits, but keep it short
    s = f"{val:.2g}"
    # Remove trailing zeros and unnecessary decimal point
    s = s.rstrip('0').rstrip('.')
    # If still too long, round to 1 digit
    if len(s) > 4:
        s = f"{val:.1g}".rstrip('0').rstrip('.')
    # If still too long, just take first 4 chars (unlikely)
    if len(s) > 4:
        s = s[:4]
    # Append unit if needed and not zero unit
    if i > 0:
        s += units[i]
    # If result is empty or just a dot, fallback to int
    if not s or s == '.':
        return str(int(x))
    return s [end of text]



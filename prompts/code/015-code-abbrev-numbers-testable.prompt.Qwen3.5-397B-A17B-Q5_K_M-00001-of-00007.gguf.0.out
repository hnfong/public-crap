```python
def abbrev_num(x):
    if x < 1000:
        return str(x)
    
    suffixes = ['K', 'M', 'B', 'T']
    magnitude = 0
    
    # Determine the magnitude
    temp = x
    while temp >= 1000 and magnitude < len(suffixes):
        temp /= 1000
        magnitude += 1
    
    # Calculate the abbreviated value
    value = x / (1000 ** magnitude)
    
    # Try formatting with one decimal place first
    if magnitude == 0:
        return str(x)
    
    # Format with one decimal
    formatted = f"{value:.1f}{suffixes[magnitude-1]}"
    
    # Check if it fits in 4 characters
    if len(formatted) <= 4:
        return formatted
    
    # If not, round to nearest whole number
    rounded_value = round(value)
    
    # Handle case where rounding increases magnitude (e.g., 999.9 -> 1000)
    if rounded_value >= 1000 and magnitude < len(suffixes):
        rounded_value = 1
        magnitude += 1
        if magnitude > len(suffixes):
            # Fallback for very large numbers
            return f"{int(value)}{suffixes[-1]}"
        suffix = suffixes[magnitude-1]
        return f"{rounded_value}{suffix}"
    
    return f"{rounded_value}{suffixes[magnitude-1]}"
``` [end of text]



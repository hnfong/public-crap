<!DOCTYPE html><html><head><title>Stack Shift</title><style>body{background:#222;display:flex;align-items:center;justify-content:center;height:100vh}#g{position:relative;width:320px;height:480px;margin:40px auto}table{background:#333;border-radius:10px}td{width:32px;height:32px;border:1px solid #444;display:flex;align-items:center;justify-content:center;font-size:18px;color:#fff;line-height:32px;text-align:center}#deck{position:absolute;top:10px;left:50%;transform:translateX(-50%);z-index:10}button{position:absolute;top:90%;left:50%;transform:translateX(-50%);padding:8px 16px;font-size:16px;background:#333;color:#fff;border:none;border-radius:6px}</style></head><body><div id="g"></div><button id="resh">Restart</button><script>let s=[],d=[],e=0,r=4,c=4;function g(){s=[...Array(16).keys()].sort(_=>Math.random()-.5);d=[];e=0;render()}function render(){let t=document.getElementById('g');t.innerHTML='';let m=[];for(let i=0;i<r;i++){let row=[];for(let j=0;j<c;j++){let idx=i*c+j;let v=s[idx];let cl='';if(d.length&&d[d.length-1][0]===i&&d[d.length-1][1]===j-1&&d[d.length-1][2]===v-1)cl='down';else if(d.length&&d[d.length-1][0]===i&&d[d.length-1][1]===j+1&&d[d.length-1][2]===v+1)cl='up';row.push(`<td class="${cl}" onclick="move(${i},${j})">${v}</td>`);}m.push(<tr>{row.join('')}</tr>);}t.innerHTML+=<table>${m.join('')}</table>;<br><div id="deck">${d.length?d[d.length-1][3]:''}</div>;<br>if(e&&e--){setTimeout(render,100);}}function move(i,j){let idx=i*c+j;let v=s[idx];if(d.length&&d[d.length-1][2]!==v-1&&d[d.length-1][2]!==v+1)return;if(d.length&&((d[d.length-1][0]===i&&((d[d.length-1][1]===j-1&&d[d.length-1][2]===v-1)||(d[d.length-1][1]===j+1&&d[d.length-1][2]===v+1)))||d[d.length-1][0]!==i))return;let ok=0;if(d.length&&d[d.length-1][0]===i&&d[d.length-1][1]===j-1&&d[d.length-1][2]===v-1){d.pop();ok=1;}else if(d.length&&d[d.length-1][0]===i&&d[d.length-1][1]===j+1&&d[d.length-1][2]===v+1){let x=d.pop();d.push([i,j,x[2]]);let y=[i,j,v];d.push(y);ok=1;}else if(!d.length||d[d.length-1][0]!==i||(!((d[d.length-1][1]===j-1&&d[d.length-1][2]===v-1)||(d[d.length-1][1]===j+1&&d[d.length-1][2]===v+1)))){d.push([i,j,v]);}if(ok){s[idx]='';render();if(!s.some(x=>x))alert('Win!');}else{alert('Invalid');}}function deal(){if(e<16)e++;let v=s.find(x=>x===null);if(!v){let idx=Math.floor(Math.random()*(16-s.filter(x=>x===null).length))+s.findIndex(x=>x===null);if(s[idx]!==null){s[idx]=e;s[e-1]=null;e++;}setTimeout(deal,80);}}function init(){s=g();render();setTimeout(deal,100)}document.getElementById('resh').onclick=()=>{s=[],d=[],e=0,g();render();};init();</script></body></html> [end of text]



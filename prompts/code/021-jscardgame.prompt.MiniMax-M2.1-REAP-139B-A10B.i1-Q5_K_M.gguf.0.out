```html
<!DOCTYPE html><html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{background:#222;color:#fff;font-family:monospace;overflow:hidden;margin:0;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center}
canvas{background:#333;box-shadow:0 4px 10px rgba(0,0,0,.5);border-radius:4px}
#ui{position:absolute;top:10px;left:10px;pointer-events:none}
button{pointer-events:auto;background:#444;border:1px solid #666;color:#fff;padding:4px 8px;cursor:pointer;margin-right:5px}
button:hover{background:#555}
</style>
</head>
<body>
<div id=ui><button onclick="init()">Reset</button><span id=score>Score:0</span></div>
<canvas id=c></canvas>
<script>
const C=document.getElementById('c'),X=C.getContext('2d'),S=document.getElementById('score');
let W=800,H=600,cardW=80,cardH=120,g=[],drag=null,deck=[],score=0;

// Card class
class Card{
 constructor(v,suit){
  this.v=v;this.suit=suit;this.x=0;this.y=0;this.faceUp=true;this.dy=0;this.targetY=0;
 }
 draw(ctx,offX=0,offY=0){
  let x=this.x+offX,y=this.y+offY;
  ctx.fillStyle=this.faceUp?'#fff':'#444';
  ctx.fillRect(x,y,cardW,cardH);
  ctx.strokeStyle='#888';ctx.strokeRect(x,y,cardW,cardH);
  if(this.faceUp){
   ctx.fillStyle=this.suit%2?'#ff':'#cc';
   ctx.font='20px Arial';ctx.textAlign='center';
   ctx.fillText(this.v>0?this.v:['A','J','Q','K'][this.v+10],x+cardW/2,y+30);
   ctx.fillText(['♥','��','♠','♣'][this.suit],x+cardW/2,y+cardH-20);
  }
 }
}

// Init
function init(){
 C.width=W;C.height=H;
 g=[];deck=[];score=0;S.innerText='Score:0';
 // Create deck
 for(let s=0;s<4;s++)for(let v=-10;v<=13;v++)deck.push(new Card(v,s));
 // Shuffle
 for(let i=deck.length-1;i>0;i--){let j=Math.random()*(i+1)|0;[deck[i],deck[j]]=[deck[j],deck[i]];}
 // Deal tableau (7 columns)
 let colX=50;
 for(let i=0;i<7;i++){
  let x=i*110+50;
  for(let j=0;j<=i;j++){
   let c=deck.pop();
   c.x=x;c.y=50+j*40;c.faceUp=j===i;
   g.push(c);
  }
 }
 // Stock
 while(deck.length)g.push(deck.pop()).forEach(c=>{c.x=50;c.y=300;c.faceUp=false});
}

// Logic
function getCardAt(mx,my){
 // Check piles (top cards only)
 let piles=[[],[],[],[]]; // foundations
 // Find top of each tableau column
 let cols={};g.forEach(c=>{
  let k=Math.round(c.x/110);
  if(!cols[k]||c.y>cols[k].y)cols[k]=c;
 });
 // Check tableau
 for(let k in cols){
  let c=cols[k];
  if(mx>=c.x&&mx<=c.x+cardW&&my>=c.y&&my<=c.y+cardH)return c;
 }
 // Check stock
 let s=g.filter(c=>c.x===50&&c.y===300);
 if(s.length&&mx>=50&&mx<=50+cardW&&my>=300&&my<=300+cardH)return s[0];
 return null;
}

function canDrop(drag,target){
 if(!target)return false;
 if(drag.suit!==target.suit)return false;
 if(drag.v!==target.v-1)return false;
 return true;
}

function canFoundation(c){
 return c.v===-10;
}

// Input
C.onmousedown=e=>{
 let r=C.getBoundingClientRect(),mx=e.clientX-r.left,my=e.clientY-r.top;
 let target=getCardAt(mx,my);
 if(target&&target.faceUp){
  // Find all face-up cards on top of this one in same column
  let stack=[];
  let col=Math.round(target.x/110);
  let startIdx=g.indexOf(target);
  for(let i=startIdx;i<g.length;i++){
   if(Math.round(g[i].x/110)!==col)continue;
   if(g[i].y>target.y&&g[i].y-target.y<50)stack.push(g[i]);
  }
  if(stack.length)drag={cards:stack,ox:mx-target.x,oy:my-target.y};
 }
};

C.onmousemove=e=>{
 if(drag){
  let r=C.getBoundingClientRect(),mx=e.clientX-r.left,my=e.clientY-r.top;
  drag.cards.forEach((c,i)=>{c.x=mx-drag.ox;c.y=my-drag.oy-i*5;});
 }
};

C.onmouseup=e=>{
 if(drag){
  let target=getCardAt(e.clientX-C.getBoundingClientRect().left,e.clientY-C.getBoundingClientRect().top);
  if(target&&target!==drag.cards[0]&&canDrop(drag.cards[0],target)){
   // Move stack
   let last=drag.cards[drag.cards.length-1];
   let newX=target.x,newY=target.y+cardH;
   drag.cards.forEach(c=>{c.x=newX;c.y=newY;c.faceUp=true;newY+=40;});
   score+=drag.cards.length*10;S.innerText='Score:'+score;
  }else if(canFoundation(drag.cards[0])&&!g.some(c=>c.x===50+cardW+20&&c.y===300)){
   // Foundation
   let fx=50+cardW+20;
   if(!g.some(c=>c.x===fx))drag.cards[0].x=fx;
   drag.cards[0].y=300;
   score+=100;S.innerText='Score:'+score;
  }
  drag=null;
 }
 requestAnimationFrame(loop);
};

function loop(){
 X.clearRect(0,0,W,H);
 // Foundations
 X.fillStyle='#444';X.fillRect(50+cardW+20,300,cardW,cardH);
 X.strokeStyle='#888';X.strokeRect(50+cardW+20,300,cardW,cardH);
 // Stock placeholder
 X.fillRect(50,300,cardW,cardH);
 // Cards
 g.forEach(c=>c.draw(X));
 requestAnimationFrame(loop);
}

init();
loop();
</script>
``` [end of text]


